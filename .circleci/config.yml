version: 2.1

orbs:
  android: circleci/android@3

jobs:
  build:
    docker:
      - image: cimg/android:2024.06  # Includes SDK + cmdline-tools + build-tools
    environment:
      ANDROID_SDK_ROOT: /opt/android/sdk
      ANDROID_HOME: /opt/android/sdk
      JAVA_TOOL_OPTIONS: -Dfile.encoding=UTF-8

    steps:
      - checkout

      # Accept all Android SDK licenses (non-interactive)
      - run: yes | sdkmanager --licenses

      # Update SDK packages (optional but good practice)
      - run: sdkmanager --update

      # If your project does NOT commit local.properties:
      - run: echo "sdk.dir=$ANDROID_SDK_ROOT" > local.properties

      # Build your APK
      - run: ./gradlew --no-daemon assembleDebug

      # Run test suite
      - run: ./gradlew --no-daemon test